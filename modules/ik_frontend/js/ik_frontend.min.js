var IKFrontend=IKFrontend||{settings:{}},IK=function(){"use strict";function e(e,t,i){this.propreties={},this.__construct(e,t,i)}function t(t){this.token=void 0,this.slides=[],this.updatedSlides=[],this.currentSlide=0,this.timeout=void 0,this.fetched=!1,this.__construct=function(e){this.token=e,this.fetchChannel()},this.fetchChannel=function(){var e=this;r("Trying to fetch channel with token: "+this.token),$.ajax({type:"POST",context:this,url:"/channels/"+this.token+"/update",dataType:"JSON",success:function(e){this.processChannel(e)},error:function(){r("Could not fetch channel from the server with token: "+this.token),0!==e.slides.length?e.nextSlide():alert("There was an error in fetching the channel. Please try agian.")}})},this.processChannel=function(t){r("Channel with token "+this.token+" fetched.");var i=this;i.updatedSlides=[],$.each(t,function(t,s){var n=new e(i.token,s.nid,!0);i.updatedSlides.push(n)}),$("body").ajaxStop(function(){if(this.fetched){if(r("All slides updated for the channel: "+i.token),0!==i.updatedSlides){var e=[];$(i.updatedSlides).each(function(){this.get("fetched")&&e.push(this)}),0!==e.length&&(i.slides=e.slice(0))}i.nextSlide()}else this.fetched=!0,r("All slides for the channel ("+i.token+") fechted"),0!==i.updatedSlides?(i.slides=i.updatedSlides.slice(0),i.start()):alert("Could not fetch all slides. Please try agian.");$("body").unbind()})},this.nextSlide=function(){var e=this,t=e.slides[e.currentSlide];t.render(),this.timeout=setTimeout(function(){e.currentSlide++,e.currentSlide===e.slides.length?(e.currentSlide=0,r("Restarting the channel to first slide"),e.fetchChannel()):e.nextSlide()},parseInt(t.get("exposure"),10))},this.start=function(){r("Starting the show"),this.nextSlide()},this.stop=function(){r("Stopping the show"),clearTimeout(this.timeout)},this.destory=function(){this.stop(),this.slides=[],this.fetched=!1,r("Channel have been destroyed.")},this.__construct(t)}function i(e){void 0===a?a=new t(e):a.start()}function s(){a.stop()}function n(t){var i=new e("","",!1);i.processSlide(t),h.animateChange=!0,i.render(),this.timeout=setTimeout(function(){i.render()},parseInt(i.get("exposure"),10))}function o(){a.destory()}function d(){h.debug=!h.debug,r("Debug: "+h.debug)}function r(e){h.debug===!0&&console.log(e)}var h={debug:!1,animateChange:!0,fullscreen:!0,orgImgAspect:[1920,1080]},a;return e.prototype.__construct=function(e,t,i){this.token=e,this.sid=t,i&&this.fetchSlide()},e.prototype.fetchSlide=function(){var e=this;r("Trying to fetch slide: "+e.sid),$.ajax({type:"POST",url:"/channels/"+e.token+"/slide/"+e.sid,context:this,dataType:"JSON",success:function(e){e.fetched=!0,this.processSlide(e)},error:function(){r("Slide "+e.sid+" fetch failed."),this.propreties.fetched=!1}})},e.prototype.processSlide=function(e){r("Slide "+this.sid+" fetched."),e.media.video.length?(this.directive={".video-container source":{"medium<-media.video":{"@src":"medium.url","@type":"medium.type"}},".slide-heading":"title",".slide-subheading":"subheading",".slide-text":"text",".logo-container img@src":"logo",".logo-container@style":function(e){return e.context.logo?"display:block;":"display:none;"}},this.template=$("#pure-template-video").compile(this.directive)):(this.directive={".image-container img":{"medium<-media.image":{"@src":"medium"}},".slide-heading":"title",".slide-subheading":"subheading",".slide-text":"text",".logo-container img@src":"logo",".logo-container@style":function(e){return e.context.logo?"display:block;":"display:none;"}},this.template=$("#pure-template-image").compile(this.directive)),this.propreties=e},e.prototype.get=function(e){return void 0!==this.propreties[e]?this.propreties[e]:void r("Slide failed to get property: "+e)},e.prototype.startCycle=function(){var e=this;if(e.get("mediacount")>1){var t=1500,i=t*(e.get("mediacount")-1),s=(e.get("exposure")-i)/e.get("mediacount");$(".image-container").cycle({fx:"fade",speed:t,timeout:s,log:!1,loop:1})}else $(".image-container img").show()},e.prototype.animateChange=function(e,t){var i=this;if(0===e.length)return $("#slide-container").html(t),void this.startCycle();if(h.fullscreen===!0){var s=h.orgImgAspect[0]/h.orgImgAspect[1],n=$(window).width(),o=$(window).height();s>n/o?$(".image-container",t).find("img").height(o):$(".image-container",t).find("img").width(n)}e.css("z-index",2),t.css("z-index",1),$("#slide-container").append(t),e.fadeOut(1500,function(){e.remove(),i.startCycle()})},e.prototype.render=function(){var e=$(this.template(this.propreties));e.attr("id","slide-"+this.get("sid")),e.addClass(this.get("layout")),e.addClass(this.get("color")),h.animateChange===!0?this.animateChange($("#slide-container .slide"),e):($("#slide-container").html(e),this.startCycle()),$("#progress").stop(!0,!0),$("#progress").css("width","0px"),$("#progress").animate({width:"100%"},this.get("exposure")),$(".slide-text").addClass(this.get("fontsize")),$(".slide-subheading").addClass(this.get("fontsize"));var t=$("#progress");if(t.stop(!0,!0),t.css("width","0px"),t.animate({width:"100%"},this.get("exposure")),a){var i=a.currentSlide+1,s=a.slides.length;$("#slide-count").text(i+" af "+s),r("Slide amount: "+s+" Current slide: "+i)}r("Slide render: "+this.get("title")+" (exposure: "+this.get("exposure")+")")},{start:i,stop:s,showSlide:n,destory:o,debug:d}}();